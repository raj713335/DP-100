\documentclass[11pt]{article}

    \usepackage[breakable]{tcolorbox}
    \usepackage{parskip} % Stop auto-indenting (to mimic markdown behaviour)
    

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % Maintain compatibility with old templates. Remove in nbconvert 6.0
    \let\Oldincludegraphics\includegraphics
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionFormat{nocaption}{}
    \captionsetup{format=nocaption,aboveskip=0pt,belowskip=0pt}

    \usepackage{float}
    \floatplacement{figure}{H} % forces figures to be placed at the correct location
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro

    \usepackage{iftex}
    \ifPDFTeX
        \usepackage[T1]{fontenc}
        \IfFileExists{alphabeta.sty}{
              \usepackage{alphabeta}
          }{
              \usepackage[mathletters]{ucs}
              \usepackage[utf8x]{inputenc}
          }
    \else
        \usepackage{fontspec}
        \usepackage{unicode-math}
    \fi

    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics 
                         % to support a larger range
    \makeatletter % fix for old versions of grffile with XeLaTeX
    \@ifpackagelater{grffile}{2019/11/01}
    {
      % Do nothing on new versions
    }
    {
      \def\Gread@@xetex#1{%
        \IfFileExists{"\Gin@base".bb}%
        {\Gread@eps{\Gin@base.bb}}%
        {\Gread@@xetex@aux#1}%
      }
    }
    \makeatother
    \usepackage[Export]{adjustbox} % Used to constrain images to a maximum size
    \adjustboxset{max size={0.9\linewidth}{0.9\paperheight}}

    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    % The default LaTeX title has an obnoxious amount of whitespace. By default,
    % titling removes some of it. It also provides customization options.
    \usepackage{titling}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage{array}     % table support for pandoc >= 2.11.3
    \usepackage{calc}      % table minipage width calculation for pandoc >= 2.11.1
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    \usepackage{mathrsfs}
    

    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}
    \definecolor{ansi-default-inverse-fg}{HTML}{FFFFFF}
    \definecolor{ansi-default-inverse-bg}{HTML}{000000}

    % common color for the border for error outputs.
    \definecolor{outerrorbackground}{HTML}{FFDFDF}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}
    
    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    
    
    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatibility definitions
    \def\gt{>}
    \def\lt{<}
    \let\Oldtex\TeX
    \let\Oldlatex\LaTeX
    \renewcommand{\TeX}{\textrm{\Oldtex}}
    \renewcommand{\LaTeX}{\textrm{\Oldlatex}}
    % Document parameters
    % Document title
    \title{Notebook}
    
    
    
    
    
% Pygments definitions
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\@namedef{PY@tok@w}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\@namedef{PY@tok@c}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cp}{\def\PY@tc##1{\textcolor[rgb]{0.61,0.40,0.00}{##1}}}
\@namedef{PY@tok@k}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kp}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kt}{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\@namedef{PY@tok@o}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@ow}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\@namedef{PY@tok@nb}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@nf}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@nc}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@nn}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@ne}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.80,0.25,0.22}{##1}}}
\@namedef{PY@tok@nv}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@no}{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\@namedef{PY@tok@nl}{\def\PY@tc##1{\textcolor[rgb]{0.46,0.46,0.00}{##1}}}
\@namedef{PY@tok@ni}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.44,0.44,0.44}{##1}}}
\@namedef{PY@tok@na}{\def\PY@tc##1{\textcolor[rgb]{0.41,0.47,0.13}{##1}}}
\@namedef{PY@tok@nt}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@nd}{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\@namedef{PY@tok@s}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sd}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@si}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.64,0.35,0.47}{##1}}}
\@namedef{PY@tok@se}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.36,0.12}{##1}}}
\@namedef{PY@tok@sr}{\def\PY@tc##1{\textcolor[rgb]{0.64,0.35,0.47}{##1}}}
\@namedef{PY@tok@ss}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@sx}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@m}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@gh}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\@namedef{PY@tok@gu}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\@namedef{PY@tok@gd}{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\@namedef{PY@tok@gi}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.52,0.00}{##1}}}
\@namedef{PY@tok@gr}{\def\PY@tc##1{\textcolor[rgb]{0.89,0.00,0.00}{##1}}}
\@namedef{PY@tok@ge}{\let\PY@it=\textit}
\@namedef{PY@tok@gs}{\let\PY@bf=\textbf}
\@namedef{PY@tok@gp}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\@namedef{PY@tok@go}{\def\PY@tc##1{\textcolor[rgb]{0.44,0.44,0.44}{##1}}}
\@namedef{PY@tok@gt}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\@namedef{PY@tok@err}{\def\PY@bc##1{{\setlength{\fboxsep}{\string -\fboxrule}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}}
\@namedef{PY@tok@kc}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kd}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kn}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kr}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@bp}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@fm}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@vc}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vg}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vi}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vm}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@sa}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sb}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sc}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@dl}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@s2}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sh}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@s1}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@mb}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mf}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mh}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mi}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@il}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mo}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@ch}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cm}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cpf}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@c1}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cs}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % For linebreaks inside Verbatim environment from package fancyvrb. 
    \makeatletter
        \newbox\Wrappedcontinuationbox 
        \newbox\Wrappedvisiblespacebox 
        \newcommand*\Wrappedvisiblespace {\textcolor{red}{\textvisiblespace}} 
        \newcommand*\Wrappedcontinuationsymbol {\textcolor{red}{\llap{\tiny$\m@th\hookrightarrow$}}} 
        \newcommand*\Wrappedcontinuationindent {3ex } 
        \newcommand*\Wrappedafterbreak {\kern\Wrappedcontinuationindent\copy\Wrappedcontinuationbox} 
        % Take advantage of the already applied Pygments mark-up to insert 
        % potential linebreaks for TeX processing. 
        %        {, <, #, %, $, ' and ": go to next line. 
        %        _, }, ^, &, >, - and ~: stay at end of broken line. 
        % Use of \textquotesingle for straight quote. 
        \newcommand*\Wrappedbreaksatspecials {% 
            \def\PYGZus{\discretionary{\char`\_}{\Wrappedafterbreak}{\char`\_}}% 
            \def\PYGZob{\discretionary{}{\Wrappedafterbreak\char`\{}{\char`\{}}% 
            \def\PYGZcb{\discretionary{\char`\}}{\Wrappedafterbreak}{\char`\}}}% 
            \def\PYGZca{\discretionary{\char`\^}{\Wrappedafterbreak}{\char`\^}}% 
            \def\PYGZam{\discretionary{\char`\&}{\Wrappedafterbreak}{\char`\&}}% 
            \def\PYGZlt{\discretionary{}{\Wrappedafterbreak\char`\<}{\char`\<}}% 
            \def\PYGZgt{\discretionary{\char`\>}{\Wrappedafterbreak}{\char`\>}}% 
            \def\PYGZsh{\discretionary{}{\Wrappedafterbreak\char`\#}{\char`\#}}% 
            \def\PYGZpc{\discretionary{}{\Wrappedafterbreak\char`\%}{\char`\%}}% 
            \def\PYGZdl{\discretionary{}{\Wrappedafterbreak\char`\$}{\char`\$}}% 
            \def\PYGZhy{\discretionary{\char`\-}{\Wrappedafterbreak}{\char`\-}}% 
            \def\PYGZsq{\discretionary{}{\Wrappedafterbreak\textquotesingle}{\textquotesingle}}% 
            \def\PYGZdq{\discretionary{}{\Wrappedafterbreak\char`\"}{\char`\"}}% 
            \def\PYGZti{\discretionary{\char`\~}{\Wrappedafterbreak}{\char`\~}}% 
        } 
        % Some characters . , ; ? ! / are not pygmentized. 
        % This macro makes them "active" and they will insert potential linebreaks 
        \newcommand*\Wrappedbreaksatpunct {% 
            \lccode`\~`\.\lowercase{\def~}{\discretionary{\hbox{\char`\.}}{\Wrappedafterbreak}{\hbox{\char`\.}}}% 
            \lccode`\~`\,\lowercase{\def~}{\discretionary{\hbox{\char`\,}}{\Wrappedafterbreak}{\hbox{\char`\,}}}% 
            \lccode`\~`\;\lowercase{\def~}{\discretionary{\hbox{\char`\;}}{\Wrappedafterbreak}{\hbox{\char`\;}}}% 
            \lccode`\~`\:\lowercase{\def~}{\discretionary{\hbox{\char`\:}}{\Wrappedafterbreak}{\hbox{\char`\:}}}% 
            \lccode`\~`\?\lowercase{\def~}{\discretionary{\hbox{\char`\?}}{\Wrappedafterbreak}{\hbox{\char`\?}}}% 
            \lccode`\~`\!\lowercase{\def~}{\discretionary{\hbox{\char`\!}}{\Wrappedafterbreak}{\hbox{\char`\!}}}% 
            \lccode`\~`\/\lowercase{\def~}{\discretionary{\hbox{\char`\/}}{\Wrappedafterbreak}{\hbox{\char`\/}}}% 
            \catcode`\.\active
            \catcode`\,\active 
            \catcode`\;\active
            \catcode`\:\active
            \catcode`\?\active
            \catcode`\!\active
            \catcode`\/\active 
            \lccode`\~`\~ 	
        }
    \makeatother

    \let\OriginalVerbatim=\Verbatim
    \makeatletter
    \renewcommand{\Verbatim}[1][1]{%
        %\parskip\z@skip
        \sbox\Wrappedcontinuationbox {\Wrappedcontinuationsymbol}%
        \sbox\Wrappedvisiblespacebox {\FV@SetupFont\Wrappedvisiblespace}%
        \def\FancyVerbFormatLine ##1{\hsize\linewidth
            \vtop{\raggedright\hyphenpenalty\z@\exhyphenpenalty\z@
                \doublehyphendemerits\z@\finalhyphendemerits\z@
                \strut ##1\strut}%
        }%
        % If the linebreak is at a space, the latter will be displayed as visible
        % space at end of first line, and a continuation symbol starts next line.
        % Stretch/shrink are however usually zero for typewriter font.
        \def\FV@Space {%
            \nobreak\hskip\z@ plus\fontdimen3\font minus\fontdimen4\font
            \discretionary{\copy\Wrappedvisiblespacebox}{\Wrappedafterbreak}
            {\kern\fontdimen2\font}%
        }%
        
        % Allow breaks at special characters using \PYG... macros.
        \Wrappedbreaksatspecials
        % Breaks at punctuation characters . , ; ? ! and / need catcode=\active 	
        \OriginalVerbatim[#1,codes*=\Wrappedbreaksatpunct]%
    }
    \makeatother

    % Exact colors from NB
    \definecolor{incolor}{HTML}{303F9F}
    \definecolor{outcolor}{HTML}{D84315}
    \definecolor{cellborder}{HTML}{CFCFCF}
    \definecolor{cellbackground}{HTML}{F7F7F7}
    
    % prompt
    \makeatletter
    \newcommand{\boxspacing}{\kern\kvtcb@left@rule\kern\kvtcb@boxsep}
    \makeatother
    \newcommand{\prompt}[4]{
        {\ttfamily\llap{{\color{#2}[#3]:\hspace{3pt}#4}}\vspace{-\baselineskip}}
    }
    

    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy 
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

\begin{document}
    
    \maketitle
    
    

    
    \hypertarget{train-models}{%
\section{Train Models}\label{train-models}}

The central goal of machine learning is to train predictive models that
can be used by applications. In Azure Machine Learning, you can use
scripts to train models leveraging common machine learning frameworks
like Scikit-Learn, Tensorflow, PyTorch, SparkML, and others. You can run
these training scripts as experiments in order to track metrics and
outputs, which include the trained models.

    \hypertarget{connect-to-your-workspace}{%
\subsection{Connect to your workspace}\label{connect-to-your-workspace}}

To get started, connect to your workspace.

\begin{quote}
\textbf{Note}: If you haven't already established an authenticated
session with your Azure subscription, you'll be prompted to authenticate
by clicking a link, entering an authentication code, and signing into
Azure.
\end{quote}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{1}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{import} \PY{n+nn}{azureml}\PY{n+nn}{.}\PY{n+nn}{core}
\PY{k+kn}{from} \PY{n+nn}{azureml}\PY{n+nn}{.}\PY{n+nn}{core} \PY{k+kn}{import} \PY{n}{Workspace}

\PY{c+c1}{\PYZsh{} Load the workspace from the saved config file}
\PY{n}{ws} \PY{o}{=} \PY{n}{Workspace}\PY{o}{.}\PY{n}{from\PYZus{}config}\PY{p}{(}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Ready to use Azure ML }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{ to work with }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{azureml}\PY{o}{.}\PY{n}{core}\PY{o}{.}\PY{n}{VERSION}\PY{p}{,} \PY{n}{ws}\PY{o}{.}\PY{n}{name}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Ready to use Azure ML 1.38.0 to work with databricks
    \end{Verbatim}

    \hypertarget{create-a-training-script}{%
\subsection{Create a training script}\label{create-a-training-script}}

You're going to use a Python script to train a machine learning model
based on the diabates data, so let's start by creating a folder for the
script and data files.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{2}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{import} \PY{n+nn}{os}\PY{o}{,} \PY{n+nn}{shutil}

\PY{c+c1}{\PYZsh{} Create a folder for the experiment files}
\PY{n}{training\PYZus{}folder} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{diabetes\PYZhy{}training}\PY{l+s+s1}{\PYZsq{}}
\PY{n}{os}\PY{o}{.}\PY{n}{makedirs}\PY{p}{(}\PY{n}{training\PYZus{}folder}\PY{p}{,} \PY{n}{exist\PYZus{}ok}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Copy the data file into the experiment folder}
\PY{n}{shutil}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{data/diabetes.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n}{training\PYZus{}folder}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{diabetes.csv}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{2}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
'diabetes-training/diabetes.csv'
\end{Verbatim}
\end{tcolorbox}
        
    Now you're ready to create the training script and save it in the
folder.

\begin{quote}
\textbf{Note}: This code \emph{creates} the script - it doesn't run it!
\end{quote}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{3}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{o}{\PYZpc{}\PYZpc{}writefile} \PYZdl{}training\PYZus{}folder/diabetes\PYZus{}training.py
\PY{c+c1}{\PYZsh{} Import libraries}
\PY{k+kn}{from} \PY{n+nn}{azureml}\PY{n+nn}{.}\PY{n+nn}{core} \PY{k+kn}{import} \PY{n}{Run}
\PY{k+kn}{import} \PY{n+nn}{pandas} \PY{k}{as} \PY{n+nn}{pd}
\PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np}
\PY{k+kn}{import} \PY{n+nn}{joblib}
\PY{k+kn}{import} \PY{n+nn}{os}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{model\PYZus{}selection} \PY{k+kn}{import} \PY{n}{train\PYZus{}test\PYZus{}split}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{linear\PYZus{}model} \PY{k+kn}{import} \PY{n}{LogisticRegression}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{metrics} \PY{k+kn}{import} \PY{n}{roc\PYZus{}auc\PYZus{}score}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{metrics} \PY{k+kn}{import} \PY{n}{roc\PYZus{}curve}

\PY{c+c1}{\PYZsh{} Get the experiment run context}
\PY{n}{run} \PY{o}{=} \PY{n}{Run}\PY{o}{.}\PY{n}{get\PYZus{}context}\PY{p}{(}\PY{p}{)}

\PY{c+c1}{\PYZsh{} load the diabetes dataset}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Loading Data...}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{diabetes} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{diabetes.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Separate features and labels}
\PY{n}{X}\PY{p}{,} \PY{n}{y} \PY{o}{=} \PY{n}{diabetes}\PY{p}{[}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Pregnancies}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{PlasmaGlucose}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{DiastolicBloodPressure}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TricepsThickness}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SerumInsulin}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{BMI}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{DiabetesPedigree}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Age}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{o}{.}\PY{n}{values}\PY{p}{,} \PY{n}{diabetes}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Diabetic}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{values}

\PY{c+c1}{\PYZsh{} Split data into training set and test set}
\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{X\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}test} \PY{o}{=} \PY{n}{train\PYZus{}test\PYZus{}split}\PY{p}{(}\PY{n}{X}\PY{p}{,} \PY{n}{y}\PY{p}{,} \PY{n}{test\PYZus{}size}\PY{o}{=}\PY{l+m+mf}{0.30}\PY{p}{,} \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Set regularization hyperparameter}
\PY{n}{reg} \PY{o}{=} \PY{l+m+mf}{0.01}

\PY{c+c1}{\PYZsh{} Train a logistic regression model}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Training a logistic regression model with regularization rate of}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{reg}\PY{p}{)}
\PY{n}{run}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Regularization Rate}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}  \PY{n}{np}\PY{o}{.}\PY{n}{float}\PY{p}{(}\PY{n}{reg}\PY{p}{)}\PY{p}{)}
\PY{n}{model} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{C}\PY{o}{=}\PY{l+m+mi}{1}\PY{o}{/}\PY{n}{reg}\PY{p}{,} \PY{n}{solver}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{liblinear}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}

\PY{c+c1}{\PYZsh{} calculate accuracy}
\PY{n}{y\PYZus{}hat} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
\PY{n}{acc} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{average}\PY{p}{(}\PY{n}{y\PYZus{}hat} \PY{o}{==} \PY{n}{y\PYZus{}test}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Accuracy:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{acc}\PY{p}{)}
\PY{n}{run}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Accuracy}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{float}\PY{p}{(}\PY{n}{acc}\PY{p}{)}\PY{p}{)}

\PY{c+c1}{\PYZsh{} calculate AUC}
\PY{n}{y\PYZus{}scores} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict\PYZus{}proba}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
\PY{n}{auc} \PY{o}{=} \PY{n}{roc\PYZus{}auc\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,}\PY{n}{y\PYZus{}scores}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AUC: }\PY{l+s+s1}{\PYZsq{}} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{auc}\PY{p}{)}\PY{p}{)}
\PY{n}{run}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AUC}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{float}\PY{p}{(}\PY{n}{auc}\PY{p}{)}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Save the trained model in the outputs folder}
\PY{n}{os}\PY{o}{.}\PY{n}{makedirs}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{outputs}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{exist\PYZus{}ok}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\PY{n}{joblib}\PY{o}{.}\PY{n}{dump}\PY{p}{(}\PY{n}{value}\PY{o}{=}\PY{n}{model}\PY{p}{,} \PY{n}{filename}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{outputs/diabetes\PYZus{}model.pkl}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{run}\PY{o}{.}\PY{n}{complete}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Writing diabetes-training/diabetes\_training.py
    \end{Verbatim}

    \hypertarget{run-the-training-script-as-an-experiment}{%
\subsection{Run the training script as an
experiment}\label{run-the-training-script-as-an-experiment}}

Now you're ready to run the script as an experiment. Note that the
default environment does not include the \textbf{scikit-learn} package,
so you need to explicitly add that to the configuration. The conda
environment is built on-demand the first time the experiment is run, and
cached for future runs that use the same configuration; so the first run
will take a little longer.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{4}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{from} \PY{n+nn}{azureml}\PY{n+nn}{.}\PY{n+nn}{core} \PY{k+kn}{import} \PY{n}{Experiment}\PY{p}{,} \PY{n}{ScriptRunConfig}\PY{p}{,} \PY{n}{Environment}
\PY{k+kn}{from} \PY{n+nn}{azureml}\PY{n+nn}{.}\PY{n+nn}{widgets} \PY{k+kn}{import} \PY{n}{RunDetails}

\PY{c+c1}{\PYZsh{} Create a Python environment for the experiment (from a .yml file)}
\PY{n}{env} \PY{o}{=} \PY{n}{Environment}\PY{o}{.}\PY{n}{from\PYZus{}conda\PYZus{}specification}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{experiment\PYZus{}env}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{environment.yml}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Create a script config}
\PY{n}{script\PYZus{}config} \PY{o}{=} \PY{n}{ScriptRunConfig}\PY{p}{(}\PY{n}{source\PYZus{}directory}\PY{o}{=}\PY{n}{training\PYZus{}folder}\PY{p}{,}
                                \PY{n}{script}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{diabetes\PYZus{}training.py}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                \PY{n}{environment}\PY{o}{=}\PY{n}{env}\PY{p}{)} 

\PY{c+c1}{\PYZsh{} submit the experiment run}
\PY{n}{experiment\PYZus{}name} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mslearn\PYZhy{}train\PYZhy{}diabetes}\PY{l+s+s1}{\PYZsq{}}
\PY{n}{experiment} \PY{o}{=} \PY{n}{Experiment}\PY{p}{(}\PY{n}{workspace}\PY{o}{=}\PY{n}{ws}\PY{p}{,} \PY{n}{name}\PY{o}{=}\PY{n}{experiment\PYZus{}name}\PY{p}{)}
\PY{n}{run} \PY{o}{=} \PY{n}{experiment}\PY{o}{.}\PY{n}{submit}\PY{p}{(}\PY{n}{config}\PY{o}{=}\PY{n}{script\PYZus{}config}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Show the running experiment run in the notebook widget}
\PY{n}{RunDetails}\PY{p}{(}\PY{n}{run}\PY{p}{)}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Block until the experiment run has completed}
\PY{n}{run}\PY{o}{.}\PY{n}{wait\PYZus{}for\PYZus{}completion}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    \begin{Verbatim}[commandchars=\\\{\}]
\_UserRunWidget(widget\_settings=\{'childWidgetDisplay': 'popup', 'send\_telemetry': False, 'log\_level': 'INFO', 'â€¦
    \end{Verbatim}

    
    
    
            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{4}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\{'runId': 'mslearn-train-diabetes\_1648321212\_a80035ba',
 'target': 'local',
 'status': 'Finalizing',
 'startTimeUtc': '2022-03-26T19:00:14.084671Z',
 'services': \{\},
 'properties': \{'\_azureml.ComputeTargetType': 'local',
  'ContentSnapshotId': 'b4a81fdd-cef1-4d01-8358-3706ca107d07',
  'azureml.git.repository\_uri': 'https://github.com/MicrosoftLearning/mslearn-
dp100',
  'mlflow.source.git.repoURL': 'https://github.com/MicrosoftLearning/mslearn-
dp100',
  'azureml.git.branch': 'main',
  'mlflow.source.git.branch': 'main',
  'azureml.git.commit': '0df707684204dd059eb4fb1cc942bfe90013bbfd',
  'mlflow.source.git.commit': '0df707684204dd059eb4fb1cc942bfe90013bbfd',
  'azureml.git.dirty': 'True'\},
 'inputDatasets': [],
 'outputDatasets': [],
 'runDefinition': \{'script': 'diabetes\_training.py',
  'command': '',
  'useAbsolutePath': False,
  'arguments': [],
  'sourceDirectoryDataStore': None,
  'framework': 'Python',
  'communicator': 'None',
  'target': 'local',
  'dataReferences': \{\},
  'data': \{\},
  'outputData': \{\},
  'datacaches': [],
  'jobName': None,
  'maxRunDurationSeconds': 2592000,
  'nodeCount': 1,
  'instanceTypes': [],
  'priority': None,
  'credentialPassthrough': False,
  'identity': None,
  'environment': \{'name': 'experiment\_env',
   'version': 'Autosave\_2022-03-26T18:56:24Z\_a13c1681',
   'python': \{'interpreterPath': 'python',
    'userManagedDependencies': False,
    'condaDependencies': \{'dependencies': ['python=3.6.2',
      'scikit-learn',
      'pandas',
      'pip',
      \{'pip': ['azureml-defaults', 'azureml-mlflow']\}],
     'name': 'azureml\_809a074975457de1dd27bdfcf2d79d61'\},
    'baseCondaEnvironment': None\},
   'environmentVariables': \{'EXAMPLE\_ENV\_VAR': 'EXAMPLE\_VALUE'\},
   'docker': \{'baseImage':
'mcr.microsoft.com/azureml/openmpi3.1.2-ubuntu18.04:20220113.v1',
    'platform': \{'os': 'Linux', 'architecture': 'amd64'\},
    'baseDockerfile': None,
    'baseImageRegistry': \{'address': None, 'username': None, 'password': None\},
    'enabled': False,
    'arguments': []\},
   'spark': \{'repositories': [], 'packages': [], 'precachePackages': True\},
   'inferencingStackVersion': None\},
  'history': \{'outputCollection': True,
   'directoriesToWatch': ['logs'],
   'enableMLflowTracking': True,
   'snapshotProject': True\},
  'spark': \{'configuration': \{'spark.app.name': 'Azure ML Experiment',
    'spark.yarn.maxAppAttempts': '1'\}\},
  'parallelTask': \{'maxRetriesPerWorker': 0,
   'workerCountPerNode': 1,
   'terminalExitCodes': None,
   'configuration': \{\}\},
  'amlCompute': \{'name': None,
   'vmSize': None,
   'retainCluster': False,
   'clusterMaxNodeCount': None\},
  'aiSuperComputer': \{'instanceType': 'D2',
   'imageVersion': 'pytorch-1.7.0',
   'location': None,
   'aiSuperComputerStorageData': None,
   'interactive': False,
   'scalePolicy': None,
   'virtualClusterArmId': None,
   'tensorboardLogDirectory': None,
   'sshPublicKey': None,
   'sshPublicKeys': None,
   'enableAzmlInt': True,
   'priority': 'Medium',
   'slaTier': 'Standard',
   'userAlias': None\},
  'kubernetesCompute': \{'instanceType': None\},
  'tensorflow': \{'workerCount': 1, 'parameterServerCount': 1\},
  'mpi': \{'processCountPerNode': 1\},
  'pyTorch': \{'communicationBackend': 'nccl', 'processCount': None\},
  'hdi': \{'yarnDeployMode': 'Cluster'\},
  'containerInstance': \{'region': None, 'cpuCores': 2.0, 'memoryGb': 3.5\},
  'exposedPorts': None,
  'docker': \{'useDocker': False,
   'sharedVolumes': True,
   'shmSize': '2g',
   'arguments': []\},
  'cmk8sCompute': \{'configuration': \{\}\},
  'commandReturnCodeConfig': \{'returnCode': 'Zero',
   'successfulReturnCodes': []\},
  'environmentVariables': \{\},
  'applicationEndpoints': \{\},
  'parameters': []\},
 'logFiles': \{'azureml-logs/60\_control\_log.txt': 'https://databricks8163606927.b
lob.core.windows.net/azureml/ExperimentRun/dcid.mslearn-train-
diabetes\_1648321212\_a80035ba/azureml-logs/60\_control\_log.txt?sv=2019-07-07\&sr=b\&
sig=KMzXDDrP9AzolWjBdU29BYJgREntUJMDREY0nrrNMYI\%3D\&skoid=0215b4ce-07ef-4072-b15a
-81ec4251c34f\&sktid=63ce7d59-2f3e-42cd-a8cc-be764cff5eb6\&skt=2022-03-26T18\%3A45\%
3A49Z\&ske=2022-03-28T02\%3A55\%3A49Z\&sks=b\&skv=2019-07-07\&st=2022-03-26T18\%3A50\%3A
24Z\&se=2022-03-27T03\%3A00\%3A24Z\&sp=r',
  'azureml-logs/70\_driver\_log.txt': 'https://databricks8163606927.blob.core.wind
ows.net/azureml/ExperimentRun/dcid.mslearn-train-
diabetes\_1648321212\_a80035ba/azureml-logs/70\_driver\_log.txt?sv=2019-07-07\&sr=b\&s
ig=IwDx\%2BQVPI9fiF\%2BTb0WpDHGFz01UNT6B2EMhJ0stZKZo\%3D\&skoid=0215b4ce-07ef-4072-b
15a-81ec4251c34f\&sktid=63ce7d59-2f3e-42cd-a8cc-be764cff5eb6\&skt=2022-03-26T18\%3A
45\%3A49Z\&ske=2022-03-28T02\%3A55\%3A49Z\&sks=b\&skv=2019-07-07\&st=2022-03-26T18\%3A50
\%3A24Z\&se=2022-03-27T03\%3A00\%3A24Z\&sp=r',
  'logs/azureml/24392\_azureml.log': 'https://databricks8163606927.blob.core.wind
ows.net/azureml/ExperimentRun/dcid.mslearn-train-diabetes\_1648321212\_a80035ba/lo
gs/azureml/24392\_azureml.log?sv=2019-07-07\&sr=b\&sig=KEWgDaEZfT4QAmvh2\%2BdS2NHs4w
w0PzVmzfX1x\%2FKtzyM\%3D\&skoid=0215b4ce-07ef-4072-b15a-81ec4251c34f\&sktid=63ce7d59
-2f3e-42cd-a8cc-be764cff5eb6\&skt=2022-03-26T18\%3A45\%3A49Z\&ske=2022-03-28T02\%3A55
\%3A49Z\&sks=b\&skv=2019-07-07\&st=2022-03-26T18\%3A50\%3A18Z\&se=2022-03-27T03\%3A00\%3A
18Z\&sp=r'\},
 'submittedBy': 'Arnab Das'\}
\end{Verbatim}
\end{tcolorbox}
        
    \begin{Verbatim}[commandchars=\\\{\}, frame=single, framerule=2mm, rulecolor=\color{outerrorbackground}]
\textcolor{ansi-red}{---------------------------------------------------------------------------}
\textcolor{ansi-red}{KeyError}                                  Traceback (most recent call last)
\textcolor{ansi-green}{/anaconda/envs/azureml\_py36/lib/python3.6/site-packages/ipywidgets/widgets/widget.py} in \textcolor{ansi-cyan}{\_handle\_msg}\textcolor{ansi-blue}{(self, msg)}
\textcolor{ansi-green-intense}{\textbf{    674}}                 \textcolor{ansi-green}{if} \textcolor{ansi-blue}{'buffer\_paths'} \textcolor{ansi-green}{in} data\textcolor{ansi-blue}{:}
\textcolor{ansi-green-intense}{\textbf{    675}}                     \_put\_buffers\textcolor{ansi-blue}{(}state\textcolor{ansi-blue}{,} data\textcolor{ansi-blue}{[}\textcolor{ansi-blue}{'buffer\_paths'}\textcolor{ansi-blue}{]}\textcolor{ansi-blue}{,} msg\textcolor{ansi-blue}{[}\textcolor{ansi-blue}{'buffers'}\textcolor{ansi-blue}{]}\textcolor{ansi-blue}{)}
\textcolor{ansi-green}{--> 676}\textcolor{ansi-red}{                 }self\textcolor{ansi-blue}{.}set\_state\textcolor{ansi-blue}{(}state\textcolor{ansi-blue}{)}
\textcolor{ansi-green-intense}{\textbf{    677}} 
\textcolor{ansi-green-intense}{\textbf{    678}}         \textcolor{ansi-red}{\# Handle a state request.}

\textcolor{ansi-green}{/anaconda/envs/azureml\_py36/lib/python3.6/site-packages/ipywidgets/widgets/widget.py} in \textcolor{ansi-cyan}{set\_state}\textcolor{ansi-blue}{(self, sync\_data)}
\textcolor{ansi-green-intense}{\textbf{    543}}                     from\_json = self.trait\_metadata(name, 'from\_json',
\textcolor{ansi-green-intense}{\textbf{    544}}                                                     self.\_trait\_from\_json)
\textcolor{ansi-green}{--> 545}\textcolor{ansi-red}{                     }self\textcolor{ansi-blue}{.}set\_trait\textcolor{ansi-blue}{(}name\textcolor{ansi-blue}{,} from\_json\textcolor{ansi-blue}{(}sync\_data\textcolor{ansi-blue}{[}name\textcolor{ansi-blue}{]}\textcolor{ansi-blue}{,} self\textcolor{ansi-blue}{)}\textcolor{ansi-blue}{)}
\textcolor{ansi-green-intense}{\textbf{    546}} 
\textcolor{ansi-green-intense}{\textbf{    547}}     \textcolor{ansi-green}{def} send\textcolor{ansi-blue}{(}self\textcolor{ansi-blue}{,} content\textcolor{ansi-blue}{,} buffers\textcolor{ansi-blue}{=}\textcolor{ansi-green}{None}\textcolor{ansi-blue}{)}\textcolor{ansi-blue}{:}

\textcolor{ansi-green}{/anaconda/envs/azureml\_py36/lib/python3.6/contextlib.py} in \textcolor{ansi-cyan}{\_\_exit\_\_}\textcolor{ansi-blue}{(self, type, value, traceback)}
\textcolor{ansi-green-intense}{\textbf{     86}}         \textcolor{ansi-green}{if} type \textcolor{ansi-green}{is} \textcolor{ansi-green}{None}\textcolor{ansi-blue}{:}
\textcolor{ansi-green-intense}{\textbf{     87}}             \textcolor{ansi-green}{try}\textcolor{ansi-blue}{:}
\textcolor{ansi-green}{---> 88}\textcolor{ansi-red}{                 }next\textcolor{ansi-blue}{(}self\textcolor{ansi-blue}{.}gen\textcolor{ansi-blue}{)}
\textcolor{ansi-green-intense}{\textbf{     89}}             \textcolor{ansi-green}{except} StopIteration\textcolor{ansi-blue}{:}
\textcolor{ansi-green-intense}{\textbf{     90}}                 \textcolor{ansi-green}{return} \textcolor{ansi-green}{False}

\textcolor{ansi-green}{/anaconda/envs/azureml\_py36/lib/python3.6/site-packages/traitlets/traitlets.py} in \textcolor{ansi-cyan}{hold\_trait\_notifications}\textcolor{ansi-blue}{(self)}
\textcolor{ansi-green-intense}{\textbf{   1129}}                 \textcolor{ansi-green}{for} changes \textcolor{ansi-green}{in} cache\textcolor{ansi-blue}{.}values\textcolor{ansi-blue}{(}\textcolor{ansi-blue}{)}\textcolor{ansi-blue}{:}
\textcolor{ansi-green-intense}{\textbf{   1130}}                     \textcolor{ansi-green}{for} change \textcolor{ansi-green}{in} changes\textcolor{ansi-blue}{:}
\textcolor{ansi-green}{-> 1131}\textcolor{ansi-red}{                         }self\textcolor{ansi-blue}{.}notify\_change\textcolor{ansi-blue}{(}change\textcolor{ansi-blue}{)}
\textcolor{ansi-green-intense}{\textbf{   1132}} 
\textcolor{ansi-green-intense}{\textbf{   1133}}     \textcolor{ansi-green}{def} \_notify\_trait\textcolor{ansi-blue}{(}self\textcolor{ansi-blue}{,} name\textcolor{ansi-blue}{,} old\_value\textcolor{ansi-blue}{,} new\_value\textcolor{ansi-blue}{)}\textcolor{ansi-blue}{:}

\textcolor{ansi-green}{/anaconda/envs/azureml\_py36/lib/python3.6/site-packages/ipywidgets/widgets/widget.py} in \textcolor{ansi-cyan}{notify\_change}\textcolor{ansi-blue}{(self, change)}
\textcolor{ansi-green-intense}{\textbf{    604}}                 \textcolor{ansi-red}{\# Send new state to front-end}
\textcolor{ansi-green-intense}{\textbf{    605}}                 self\textcolor{ansi-blue}{.}send\_state\textcolor{ansi-blue}{(}key\textcolor{ansi-blue}{=}name\textcolor{ansi-blue}{)}
\textcolor{ansi-green}{--> 606}\textcolor{ansi-red}{         }super\textcolor{ansi-blue}{(}Widget\textcolor{ansi-blue}{,} self\textcolor{ansi-blue}{)}\textcolor{ansi-blue}{.}notify\_change\textcolor{ansi-blue}{(}change\textcolor{ansi-blue}{)}
\textcolor{ansi-green-intense}{\textbf{    607}} 
\textcolor{ansi-green-intense}{\textbf{    608}}     \textcolor{ansi-green}{def} \_\_repr\_\_\textcolor{ansi-blue}{(}self\textcolor{ansi-blue}{)}\textcolor{ansi-blue}{:}

\textcolor{ansi-green}{/anaconda/envs/azureml\_py36/lib/python3.6/site-packages/traitlets/traitlets.py} in \textcolor{ansi-cyan}{notify\_change}\textcolor{ansi-blue}{(self, change)}
\textcolor{ansi-green-intense}{\textbf{   1174}}                 c \textcolor{ansi-blue}{=} getattr\textcolor{ansi-blue}{(}self\textcolor{ansi-blue}{,} c\textcolor{ansi-blue}{.}name\textcolor{ansi-blue}{)}
\textcolor{ansi-green-intense}{\textbf{   1175}} 
\textcolor{ansi-green}{-> 1176}\textcolor{ansi-red}{             }c\textcolor{ansi-blue}{(}change\textcolor{ansi-blue}{)}
\textcolor{ansi-green-intense}{\textbf{   1177}} 
\textcolor{ansi-green-intense}{\textbf{   1178}}     \textcolor{ansi-green}{def} \_add\_notifiers\textcolor{ansi-blue}{(}self\textcolor{ansi-blue}{,} handler\textcolor{ansi-blue}{,} name\textcolor{ansi-blue}{,} type\textcolor{ansi-blue}{)}\textcolor{ansi-blue}{:}

\textcolor{ansi-green}{/anaconda/envs/azureml\_py36/lib/python3.6/site-packages/azureml/widgets/\_userrun/\_run\_details.py} in \textcolor{ansi-cyan}{\_on\_selected\_run\_log\_change}\textcolor{ansi-blue}{(self, change)}
\textcolor{ansi-green-intense}{\textbf{    622}}     \textcolor{ansi-green}{def} \_on\_selected\_run\_log\_change\textcolor{ansi-blue}{(}self\textcolor{ansi-blue}{,} change\textcolor{ansi-blue}{)}\textcolor{ansi-blue}{:}
\textcolor{ansi-green-intense}{\textbf{    623}}         self\textcolor{ansi-blue}{.}selected\_run\_log \textcolor{ansi-blue}{=} change\textcolor{ansi-blue}{.}new
\textcolor{ansi-green}{--> 624}\textcolor{ansi-red}{         self.\_get\_run\_logs\_async(self.widget\_instance.run\_properties['log\_files'],
}\textcolor{ansi-green-intense}{\textbf{    625}}                                  self\textcolor{ansi-blue}{.}widget\_instance\textcolor{ansi-blue}{.}run\_properties\textcolor{ansi-blue}{[}\textcolor{ansi-blue}{'status'}\textcolor{ansi-blue}{]}\textcolor{ansi-blue}{,}
\textcolor{ansi-green-intense}{\textbf{    626}}                                  self.error, change.new)

\textcolor{ansi-red}{KeyError}: 'log\_files'
    \end{Verbatim}

    You can retrieve the metrics and outputs from the \textbf{Run} object.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{5}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Get logged metrics and files}
\PY{n}{metrics} \PY{o}{=} \PY{n}{run}\PY{o}{.}\PY{n}{get\PYZus{}metrics}\PY{p}{(}\PY{p}{)}
\PY{k}{for} \PY{n}{key} \PY{o+ow}{in} \PY{n}{metrics}\PY{o}{.}\PY{n}{keys}\PY{p}{(}\PY{p}{)}\PY{p}{:}
        \PY{n+nb}{print}\PY{p}{(}\PY{n}{key}\PY{p}{,} \PY{n}{metrics}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{n}{key}\PY{p}{)}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{k}{for} \PY{n}{file} \PY{o+ow}{in} \PY{n}{run}\PY{o}{.}\PY{n}{get\PYZus{}file\PYZus{}names}\PY{p}{(}\PY{p}{)}\PY{p}{:}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{file}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Regularization Rate 0.01
Accuracy 0.774
AUC 0.8483377282451863


azureml-logs/60\_control\_log.txt
azureml-logs/70\_driver\_log.txt
logs/azureml/24392\_azureml.log
outputs/diabetes\_model.pkl
    \end{Verbatim}

    \hypertarget{register-the-trained-model}{%
\subsection{Register the trained
model}\label{register-the-trained-model}}

Note that the outputs of the experiment include the trained model file
(\textbf{diabetes\_model.pkl}). You can register this model in your
Azure Machine Learning workspace, making it possible to track model
versions and retrieve them later.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{6}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{from} \PY{n+nn}{azureml}\PY{n+nn}{.}\PY{n+nn}{core} \PY{k+kn}{import} \PY{n}{Model}

\PY{c+c1}{\PYZsh{} Register the model}
\PY{n}{run}\PY{o}{.}\PY{n}{register\PYZus{}model}\PY{p}{(}\PY{n}{model\PYZus{}path}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{outputs/diabetes\PYZus{}model.pkl}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{model\PYZus{}name}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{diabetes\PYZus{}model}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                   \PY{n}{tags}\PY{o}{=}\PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Training context}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Script}\PY{l+s+s1}{\PYZsq{}}\PY{p}{\PYZcb{}}\PY{p}{,}
                   \PY{n}{properties}\PY{o}{=}\PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AUC}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{run}\PY{o}{.}\PY{n}{get\PYZus{}metrics}\PY{p}{(}\PY{p}{)}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AUC}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Accuracy}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{run}\PY{o}{.}\PY{n}{get\PYZus{}metrics}\PY{p}{(}\PY{p}{)}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Accuracy}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{\PYZcb{}}\PY{p}{)}

\PY{c+c1}{\PYZsh{} List registered models}
\PY{k}{for} \PY{n}{model} \PY{o+ow}{in} \PY{n}{Model}\PY{o}{.}\PY{n}{list}\PY{p}{(}\PY{n}{ws}\PY{p}{)}\PY{p}{:}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{model}\PY{o}{.}\PY{n}{name}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{version:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{model}\PY{o}{.}\PY{n}{version}\PY{p}{)}
    \PY{k}{for} \PY{n}{tag\PYZus{}name} \PY{o+ow}{in} \PY{n}{model}\PY{o}{.}\PY{n}{tags}\PY{p}{:}
        \PY{n}{tag} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{tags}\PY{p}{[}\PY{n}{tag\PYZus{}name}\PY{p}{]}
        \PY{n+nb}{print} \PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}t}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{tag\PYZus{}name}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{tag}\PY{p}{)}
    \PY{k}{for} \PY{n}{prop\PYZus{}name} \PY{o+ow}{in} \PY{n}{model}\PY{o}{.}\PY{n}{properties}\PY{p}{:}
        \PY{n}{prop} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{properties}\PY{p}{[}\PY{n}{prop\PYZus{}name}\PY{p}{]}
        \PY{n+nb}{print} \PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}t}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{prop\PYZus{}name}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{prop}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
diabetes\_model version: 1
         Training context : Script
         AUC : 0.8483377282451863
         Accuracy : 0.774


amlstudio-designer-predict-dia version: 1
         CreatedByAMLStudio : true


AutoMLfc1f1f9bf0 version: 1


    \end{Verbatim}

    \begin{quote}
\textbf{Note}: The code above uses \emph{properties} and \emph{tags} to
note additional information about the model. The key difference between
properties and tags is that properties cannot be changed after the model
is registered, while tags for a registered model can be modified.
\end{quote}

\hypertarget{create-a-parameterized-training-script}{%
\subsection{Create a parameterized training
script}\label{create-a-parameterized-training-script}}

You can increase the flexibility of your training experiment by adding
parameters to your script, enabling you to repeat the same training
experiment with different settings. In this case, you'll add a parameter
for the regularization rate used by the logistic regression algorithm
when training the model.

Again, lets start by creating a folder for the parameterized script and
the training data.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{7}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{import} \PY{n+nn}{os}\PY{o}{,} \PY{n+nn}{shutil}

\PY{c+c1}{\PYZsh{} Create a folder for the experiment files}
\PY{n}{training\PYZus{}folder} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{diabetes\PYZhy{}training\PYZhy{}params}\PY{l+s+s1}{\PYZsq{}}
\PY{n}{os}\PY{o}{.}\PY{n}{makedirs}\PY{p}{(}\PY{n}{training\PYZus{}folder}\PY{p}{,} \PY{n}{exist\PYZus{}ok}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Copy the data file into the experiment folder}
\PY{n}{shutil}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{data/diabetes.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n}{training\PYZus{}folder}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{diabetes.csv}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{7}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
'diabetes-training-params/diabetes.csv'
\end{Verbatim}
\end{tcolorbox}
        
    Now let's create a script with an argument for the regularization rate
hyperparameter. The argument is read using a Python
\textbf{argparse.ArgumentParser} object.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{8}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{o}{\PYZpc{}\PYZpc{}writefile} \PYZdl{}training\PYZus{}folder/diabetes\PYZus{}training.py
\PY{c+c1}{\PYZsh{} Import libraries}
\PY{k+kn}{from} \PY{n+nn}{azureml}\PY{n+nn}{.}\PY{n+nn}{core} \PY{k+kn}{import} \PY{n}{Run}
\PY{k+kn}{import} \PY{n+nn}{pandas} \PY{k}{as} \PY{n+nn}{pd}
\PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np}
\PY{k+kn}{import} \PY{n+nn}{joblib}
\PY{k+kn}{import} \PY{n+nn}{os}
\PY{k+kn}{import} \PY{n+nn}{argparse}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{model\PYZus{}selection} \PY{k+kn}{import} \PY{n}{train\PYZus{}test\PYZus{}split}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{linear\PYZus{}model} \PY{k+kn}{import} \PY{n}{LogisticRegression}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{metrics} \PY{k+kn}{import} \PY{n}{roc\PYZus{}auc\PYZus{}score}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{metrics} \PY{k+kn}{import} \PY{n}{roc\PYZus{}curve}

\PY{c+c1}{\PYZsh{} Get the experiment run context}
\PY{n}{run} \PY{o}{=} \PY{n}{Run}\PY{o}{.}\PY{n}{get\PYZus{}context}\PY{p}{(}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Set regularization hyperparameter}
\PY{n}{parser} \PY{o}{=} \PY{n}{argparse}\PY{o}{.}\PY{n}{ArgumentParser}\PY{p}{(}\PY{p}{)}
\PY{n}{parser}\PY{o}{.}\PY{n}{add\PYZus{}argument}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}reg\PYZus{}rate}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n+nb}{type}\PY{o}{=}\PY{n+nb}{float}\PY{p}{,} \PY{n}{dest}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{default}\PY{o}{=}\PY{l+m+mf}{0.01}\PY{p}{)}
\PY{n}{args} \PY{o}{=} \PY{n}{parser}\PY{o}{.}\PY{n}{parse\PYZus{}args}\PY{p}{(}\PY{p}{)}
\PY{n}{reg} \PY{o}{=} \PY{n}{args}\PY{o}{.}\PY{n}{reg}

\PY{c+c1}{\PYZsh{} load the diabetes dataset}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Loading Data...}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{c+c1}{\PYZsh{} load the diabetes dataset}
\PY{n}{diabetes} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{diabetes.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Separate features and labels}
\PY{n}{X}\PY{p}{,} \PY{n}{y} \PY{o}{=} \PY{n}{diabetes}\PY{p}{[}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Pregnancies}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{PlasmaGlucose}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{DiastolicBloodPressure}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TricepsThickness}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SerumInsulin}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{BMI}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{DiabetesPedigree}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Age}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{o}{.}\PY{n}{values}\PY{p}{,} \PY{n}{diabetes}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Diabetic}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{values}

\PY{c+c1}{\PYZsh{} Split data into training set and test set}
\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{X\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}test} \PY{o}{=} \PY{n}{train\PYZus{}test\PYZus{}split}\PY{p}{(}\PY{n}{X}\PY{p}{,} \PY{n}{y}\PY{p}{,} \PY{n}{test\PYZus{}size}\PY{o}{=}\PY{l+m+mf}{0.30}\PY{p}{,} \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Train a logistic regression model}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Training a logistic regression model with regularization rate of}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{reg}\PY{p}{)}
\PY{n}{run}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Regularization Rate}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}  \PY{n}{np}\PY{o}{.}\PY{n}{float}\PY{p}{(}\PY{n}{reg}\PY{p}{)}\PY{p}{)}
\PY{n}{model} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{C}\PY{o}{=}\PY{l+m+mi}{1}\PY{o}{/}\PY{n}{reg}\PY{p}{,} \PY{n}{solver}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{liblinear}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}

\PY{c+c1}{\PYZsh{} calculate accuracy}
\PY{n}{y\PYZus{}hat} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
\PY{n}{acc} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{average}\PY{p}{(}\PY{n}{y\PYZus{}hat} \PY{o}{==} \PY{n}{y\PYZus{}test}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Accuracy:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{acc}\PY{p}{)}
\PY{n}{run}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Accuracy}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{float}\PY{p}{(}\PY{n}{acc}\PY{p}{)}\PY{p}{)}

\PY{c+c1}{\PYZsh{} calculate AUC}
\PY{n}{y\PYZus{}scores} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict\PYZus{}proba}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
\PY{n}{auc} \PY{o}{=} \PY{n}{roc\PYZus{}auc\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,}\PY{n}{y\PYZus{}scores}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AUC: }\PY{l+s+s1}{\PYZsq{}} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{auc}\PY{p}{)}\PY{p}{)}
\PY{n}{run}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AUC}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{float}\PY{p}{(}\PY{n}{auc}\PY{p}{)}\PY{p}{)}

\PY{n}{os}\PY{o}{.}\PY{n}{makedirs}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{outputs}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{exist\PYZus{}ok}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\PY{n}{joblib}\PY{o}{.}\PY{n}{dump}\PY{p}{(}\PY{n}{value}\PY{o}{=}\PY{n}{model}\PY{p}{,} \PY{n}{filename}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{outputs/diabetes\PYZus{}model.pkl}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{run}\PY{o}{.}\PY{n}{complete}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Writing diabetes-training-params/diabetes\_training.py
    \end{Verbatim}

    \hypertarget{run-the-script-with-arguments}{%
\subsection{Run the script with
arguments}\label{run-the-script-with-arguments}}

You run the script as an experiment like you did previously, reusing the
environment you created; but this time you must provide the
\textbf{--reg\_rate} parameter that the script expects as an argument.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{9}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Create a script config}
\PY{n}{script\PYZus{}config} \PY{o}{=} \PY{n}{ScriptRunConfig}\PY{p}{(}\PY{n}{source\PYZus{}directory}\PY{o}{=}\PY{n}{training\PYZus{}folder}\PY{p}{,}
                                \PY{n}{script}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{diabetes\PYZus{}training.py}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                \PY{n}{arguments} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}reg\PYZus{}rate}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mf}{0.1}\PY{p}{]}\PY{p}{,}
                                \PY{n}{environment}\PY{o}{=}\PY{n}{env}\PY{p}{)} 

\PY{c+c1}{\PYZsh{} submit the experiment}
\PY{n}{experiment\PYZus{}name} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mslearn\PYZhy{}train\PYZhy{}diabetes}\PY{l+s+s1}{\PYZsq{}}
\PY{n}{experiment} \PY{o}{=} \PY{n}{Experiment}\PY{p}{(}\PY{n}{workspace}\PY{o}{=}\PY{n}{ws}\PY{p}{,} \PY{n}{name}\PY{o}{=}\PY{n}{experiment\PYZus{}name}\PY{p}{)}
\PY{n}{run} \PY{o}{=} \PY{n}{experiment}\PY{o}{.}\PY{n}{submit}\PY{p}{(}\PY{n}{config}\PY{o}{=}\PY{n}{script\PYZus{}config}\PY{p}{)}
\PY{n}{RunDetails}\PY{p}{(}\PY{n}{run}\PY{p}{)}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\PY{n}{run}\PY{o}{.}\PY{n}{wait\PYZus{}for\PYZus{}completion}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    \begin{Verbatim}[commandchars=\\\{\}]
\_UserRunWidget(widget\_settings=\{'childWidgetDisplay': 'popup', 'send\_telemetry': False, 'log\_level': 'INFO', 'â€¦
    \end{Verbatim}

    
    
    
            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{9}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\{'runId': 'mslearn-train-diabetes\_1648321262\_426daf3e',
 'target': 'local',
 'status': 'Completed',
 'startTimeUtc': '2022-03-26T19:01:03.188539Z',
 'endTimeUtc': '2022-03-26T19:01:08.27257Z',
 'services': \{\},
 'properties': \{'\_azureml.ComputeTargetType': 'local',
  'ContentSnapshotId': 'c14f33a9-5328-4eda-84ec-d9c47fc260d9',
  'azureml.git.repository\_uri': 'https://github.com/MicrosoftLearning/mslearn-
dp100',
  'mlflow.source.git.repoURL': 'https://github.com/MicrosoftLearning/mslearn-
dp100',
  'azureml.git.branch': 'main',
  'mlflow.source.git.branch': 'main',
  'azureml.git.commit': '0df707684204dd059eb4fb1cc942bfe90013bbfd',
  'mlflow.source.git.commit': '0df707684204dd059eb4fb1cc942bfe90013bbfd',
  'azureml.git.dirty': 'True'\},
 'inputDatasets': [],
 'outputDatasets': [],
 'runDefinition': \{'script': 'diabetes\_training.py',
  'command': '',
  'useAbsolutePath': False,
  'arguments': ['--reg\_rate', '0.1'],
  'sourceDirectoryDataStore': None,
  'framework': 'Python',
  'communicator': 'None',
  'target': 'local',
  'dataReferences': \{\},
  'data': \{\},
  'outputData': \{\},
  'datacaches': [],
  'jobName': None,
  'maxRunDurationSeconds': 2592000,
  'nodeCount': 1,
  'instanceTypes': [],
  'priority': None,
  'credentialPassthrough': False,
  'identity': None,
  'environment': \{'name': 'experiment\_env',
   'version': 'Autosave\_2022-03-26T18:56:24Z\_a13c1681',
   'python': \{'interpreterPath': 'python',
    'userManagedDependencies': False,
    'condaDependencies': \{'dependencies': ['python=3.6.2',
      'scikit-learn',
      'pandas',
      'pip',
      \{'pip': ['azureml-defaults', 'azureml-mlflow']\}],
     'name': 'azureml\_809a074975457de1dd27bdfcf2d79d61'\},
    'baseCondaEnvironment': None\},
   'environmentVariables': \{'EXAMPLE\_ENV\_VAR': 'EXAMPLE\_VALUE'\},
   'docker': \{'baseImage':
'mcr.microsoft.com/azureml/openmpi3.1.2-ubuntu18.04:20220113.v1',
    'platform': \{'os': 'Linux', 'architecture': 'amd64'\},
    'baseDockerfile': None,
    'baseImageRegistry': \{'address': None, 'username': None, 'password': None\},
    'enabled': False,
    'arguments': []\},
   'spark': \{'repositories': [], 'packages': [], 'precachePackages': True\},
   'inferencingStackVersion': None\},
  'history': \{'outputCollection': True,
   'directoriesToWatch': ['logs'],
   'enableMLflowTracking': True,
   'snapshotProject': True\},
  'spark': \{'configuration': \{'spark.app.name': 'Azure ML Experiment',
    'spark.yarn.maxAppAttempts': '1'\}\},
  'parallelTask': \{'maxRetriesPerWorker': 0,
   'workerCountPerNode': 1,
   'terminalExitCodes': None,
   'configuration': \{\}\},
  'amlCompute': \{'name': None,
   'vmSize': None,
   'retainCluster': False,
   'clusterMaxNodeCount': None\},
  'aiSuperComputer': \{'instanceType': 'D2',
   'imageVersion': 'pytorch-1.7.0',
   'location': None,
   'aiSuperComputerStorageData': None,
   'interactive': False,
   'scalePolicy': None,
   'virtualClusterArmId': None,
   'tensorboardLogDirectory': None,
   'sshPublicKey': None,
   'sshPublicKeys': None,
   'enableAzmlInt': True,
   'priority': 'Medium',
   'slaTier': 'Standard',
   'userAlias': None\},
  'kubernetesCompute': \{'instanceType': None\},
  'tensorflow': \{'workerCount': 1, 'parameterServerCount': 1\},
  'mpi': \{'processCountPerNode': 1\},
  'pyTorch': \{'communicationBackend': 'nccl', 'processCount': None\},
  'hdi': \{'yarnDeployMode': 'Cluster'\},
  'containerInstance': \{'region': None, 'cpuCores': 2.0, 'memoryGb': 3.5\},
  'exposedPorts': None,
  'docker': \{'useDocker': False,
   'sharedVolumes': True,
   'shmSize': '2g',
   'arguments': []\},
  'cmk8sCompute': \{'configuration': \{\}\},
  'commandReturnCodeConfig': \{'returnCode': 'Zero',
   'successfulReturnCodes': []\},
  'environmentVariables': \{\},
  'applicationEndpoints': \{\},
  'parameters': []\},
 'logFiles': \{'azureml-logs/60\_control\_log.txt': 'https://databricks8163606927.b
lob.core.windows.net/azureml/ExperimentRun/dcid.mslearn-train-
diabetes\_1648321262\_426daf3e/azureml-logs/60\_control\_log.txt?sv=2019-07-07\&sr=b\&
sig=LApFDXirZiW2poy6jSiuOdb3\%2B98B1e5paCx750WD64Q\%3D\&skoid=0215b4ce-07ef-4072-b1
5a-81ec4251c34f\&sktid=63ce7d59-2f3e-42cd-a8cc-be764cff5eb6\&skt=2022-03-26T18\%3A4
5\%3A49Z\&ske=2022-03-28T02\%3A55\%3A49Z\&sks=b\&skv=2019-07-07\&st=2022-03-26T18\%3A51\%
3A09Z\&se=2022-03-27T03\%3A01\%3A09Z\&sp=r',
  'azureml-logs/70\_driver\_log.txt': 'https://databricks8163606927.blob.core.wind
ows.net/azureml/ExperimentRun/dcid.mslearn-train-
diabetes\_1648321262\_426daf3e/azureml-logs/70\_driver\_log.txt?sv=2019-07-07\&sr=b\&s
ig=LlmK60uClqGgz982gK7IqryuVjJVtJr0Ou7oImw2Z\%2Bw\%3D\&skoid=0215b4ce-07ef-4072-b15
a-81ec4251c34f\&sktid=63ce7d59-2f3e-42cd-a8cc-be764cff5eb6\&skt=2022-03-26T18\%3A45
\%3A49Z\&ske=2022-03-28T02\%3A55\%3A49Z\&sks=b\&skv=2019-07-07\&st=2022-03-26T18\%3A51\%3
A09Z\&se=2022-03-27T03\%3A01\%3A09Z\&sp=r',
  'logs/azureml/26335\_azureml.log': 'https://databricks8163606927.blob.core.wind
ows.net/azureml/ExperimentRun/dcid.mslearn-train-diabetes\_1648321262\_426daf3e/lo
gs/azureml/26335\_azureml.log?sv=2019-07-07\&sr=b\&sig=WyLgrDr\%2BHgTQgOcl4KXcw94U9W
4xZlt3pwFLOKuC9MU\%3D\&skoid=0215b4ce-07ef-4072-b15a-81ec4251c34f\&sktid=63ce7d59-2
f3e-42cd-a8cc-be764cff5eb6\&skt=2022-03-26T18\%3A45\%3A49Z\&ske=2022-03-28T02\%3A55\%3
A49Z\&sks=b\&skv=2019-07-07\&st=2022-03-26T18\%3A51\%3A07Z\&se=2022-03-27T03\%3A01\%3A07
Z\&sp=r'\},
 'submittedBy': 'Arnab Das'\}
\end{Verbatim}
\end{tcolorbox}
        
    \begin{Verbatim}[commandchars=\\\{\}, frame=single, framerule=2mm, rulecolor=\color{outerrorbackground}]
\textcolor{ansi-red}{---------------------------------------------------------------------------}
\textcolor{ansi-red}{KeyError}                                  Traceback (most recent call last)
\textcolor{ansi-green}{/anaconda/envs/azureml\_py36/lib/python3.6/site-packages/ipywidgets/widgets/widget.py} in \textcolor{ansi-cyan}{\_handle\_msg}\textcolor{ansi-blue}{(self, msg)}
\textcolor{ansi-green-intense}{\textbf{    674}}                 \textcolor{ansi-green}{if} \textcolor{ansi-blue}{'buffer\_paths'} \textcolor{ansi-green}{in} data\textcolor{ansi-blue}{:}
\textcolor{ansi-green-intense}{\textbf{    675}}                     \_put\_buffers\textcolor{ansi-blue}{(}state\textcolor{ansi-blue}{,} data\textcolor{ansi-blue}{[}\textcolor{ansi-blue}{'buffer\_paths'}\textcolor{ansi-blue}{]}\textcolor{ansi-blue}{,} msg\textcolor{ansi-blue}{[}\textcolor{ansi-blue}{'buffers'}\textcolor{ansi-blue}{]}\textcolor{ansi-blue}{)}
\textcolor{ansi-green}{--> 676}\textcolor{ansi-red}{                 }self\textcolor{ansi-blue}{.}set\_state\textcolor{ansi-blue}{(}state\textcolor{ansi-blue}{)}
\textcolor{ansi-green-intense}{\textbf{    677}} 
\textcolor{ansi-green-intense}{\textbf{    678}}         \textcolor{ansi-red}{\# Handle a state request.}

\textcolor{ansi-green}{/anaconda/envs/azureml\_py36/lib/python3.6/site-packages/ipywidgets/widgets/widget.py} in \textcolor{ansi-cyan}{set\_state}\textcolor{ansi-blue}{(self, sync\_data)}
\textcolor{ansi-green-intense}{\textbf{    543}}                     from\_json = self.trait\_metadata(name, 'from\_json',
\textcolor{ansi-green-intense}{\textbf{    544}}                                                     self.\_trait\_from\_json)
\textcolor{ansi-green}{--> 545}\textcolor{ansi-red}{                     }self\textcolor{ansi-blue}{.}set\_trait\textcolor{ansi-blue}{(}name\textcolor{ansi-blue}{,} from\_json\textcolor{ansi-blue}{(}sync\_data\textcolor{ansi-blue}{[}name\textcolor{ansi-blue}{]}\textcolor{ansi-blue}{,} self\textcolor{ansi-blue}{)}\textcolor{ansi-blue}{)}
\textcolor{ansi-green-intense}{\textbf{    546}} 
\textcolor{ansi-green-intense}{\textbf{    547}}     \textcolor{ansi-green}{def} send\textcolor{ansi-blue}{(}self\textcolor{ansi-blue}{,} content\textcolor{ansi-blue}{,} buffers\textcolor{ansi-blue}{=}\textcolor{ansi-green}{None}\textcolor{ansi-blue}{)}\textcolor{ansi-blue}{:}

\textcolor{ansi-green}{/anaconda/envs/azureml\_py36/lib/python3.6/contextlib.py} in \textcolor{ansi-cyan}{\_\_exit\_\_}\textcolor{ansi-blue}{(self, type, value, traceback)}
\textcolor{ansi-green-intense}{\textbf{     86}}         \textcolor{ansi-green}{if} type \textcolor{ansi-green}{is} \textcolor{ansi-green}{None}\textcolor{ansi-blue}{:}
\textcolor{ansi-green-intense}{\textbf{     87}}             \textcolor{ansi-green}{try}\textcolor{ansi-blue}{:}
\textcolor{ansi-green}{---> 88}\textcolor{ansi-red}{                 }next\textcolor{ansi-blue}{(}self\textcolor{ansi-blue}{.}gen\textcolor{ansi-blue}{)}
\textcolor{ansi-green-intense}{\textbf{     89}}             \textcolor{ansi-green}{except} StopIteration\textcolor{ansi-blue}{:}
\textcolor{ansi-green-intense}{\textbf{     90}}                 \textcolor{ansi-green}{return} \textcolor{ansi-green}{False}

\textcolor{ansi-green}{/anaconda/envs/azureml\_py36/lib/python3.6/site-packages/traitlets/traitlets.py} in \textcolor{ansi-cyan}{hold\_trait\_notifications}\textcolor{ansi-blue}{(self)}
\textcolor{ansi-green-intense}{\textbf{   1129}}                 \textcolor{ansi-green}{for} changes \textcolor{ansi-green}{in} cache\textcolor{ansi-blue}{.}values\textcolor{ansi-blue}{(}\textcolor{ansi-blue}{)}\textcolor{ansi-blue}{:}
\textcolor{ansi-green-intense}{\textbf{   1130}}                     \textcolor{ansi-green}{for} change \textcolor{ansi-green}{in} changes\textcolor{ansi-blue}{:}
\textcolor{ansi-green}{-> 1131}\textcolor{ansi-red}{                         }self\textcolor{ansi-blue}{.}notify\_change\textcolor{ansi-blue}{(}change\textcolor{ansi-blue}{)}
\textcolor{ansi-green-intense}{\textbf{   1132}} 
\textcolor{ansi-green-intense}{\textbf{   1133}}     \textcolor{ansi-green}{def} \_notify\_trait\textcolor{ansi-blue}{(}self\textcolor{ansi-blue}{,} name\textcolor{ansi-blue}{,} old\_value\textcolor{ansi-blue}{,} new\_value\textcolor{ansi-blue}{)}\textcolor{ansi-blue}{:}

\textcolor{ansi-green}{/anaconda/envs/azureml\_py36/lib/python3.6/site-packages/ipywidgets/widgets/widget.py} in \textcolor{ansi-cyan}{notify\_change}\textcolor{ansi-blue}{(self, change)}
\textcolor{ansi-green-intense}{\textbf{    604}}                 \textcolor{ansi-red}{\# Send new state to front-end}
\textcolor{ansi-green-intense}{\textbf{    605}}                 self\textcolor{ansi-blue}{.}send\_state\textcolor{ansi-blue}{(}key\textcolor{ansi-blue}{=}name\textcolor{ansi-blue}{)}
\textcolor{ansi-green}{--> 606}\textcolor{ansi-red}{         }super\textcolor{ansi-blue}{(}Widget\textcolor{ansi-blue}{,} self\textcolor{ansi-blue}{)}\textcolor{ansi-blue}{.}notify\_change\textcolor{ansi-blue}{(}change\textcolor{ansi-blue}{)}
\textcolor{ansi-green-intense}{\textbf{    607}} 
\textcolor{ansi-green-intense}{\textbf{    608}}     \textcolor{ansi-green}{def} \_\_repr\_\_\textcolor{ansi-blue}{(}self\textcolor{ansi-blue}{)}\textcolor{ansi-blue}{:}

\textcolor{ansi-green}{/anaconda/envs/azureml\_py36/lib/python3.6/site-packages/traitlets/traitlets.py} in \textcolor{ansi-cyan}{notify\_change}\textcolor{ansi-blue}{(self, change)}
\textcolor{ansi-green-intense}{\textbf{   1174}}                 c \textcolor{ansi-blue}{=} getattr\textcolor{ansi-blue}{(}self\textcolor{ansi-blue}{,} c\textcolor{ansi-blue}{.}name\textcolor{ansi-blue}{)}
\textcolor{ansi-green-intense}{\textbf{   1175}} 
\textcolor{ansi-green}{-> 1176}\textcolor{ansi-red}{             }c\textcolor{ansi-blue}{(}change\textcolor{ansi-blue}{)}
\textcolor{ansi-green-intense}{\textbf{   1177}} 
\textcolor{ansi-green-intense}{\textbf{   1178}}     \textcolor{ansi-green}{def} \_add\_notifiers\textcolor{ansi-blue}{(}self\textcolor{ansi-blue}{,} handler\textcolor{ansi-blue}{,} name\textcolor{ansi-blue}{,} type\textcolor{ansi-blue}{)}\textcolor{ansi-blue}{:}

\textcolor{ansi-green}{/anaconda/envs/azureml\_py36/lib/python3.6/site-packages/azureml/widgets/\_userrun/\_run\_details.py} in \textcolor{ansi-cyan}{\_on\_selected\_run\_log\_change}\textcolor{ansi-blue}{(self, change)}
\textcolor{ansi-green-intense}{\textbf{    622}}     \textcolor{ansi-green}{def} \_on\_selected\_run\_log\_change\textcolor{ansi-blue}{(}self\textcolor{ansi-blue}{,} change\textcolor{ansi-blue}{)}\textcolor{ansi-blue}{:}
\textcolor{ansi-green-intense}{\textbf{    623}}         self\textcolor{ansi-blue}{.}selected\_run\_log \textcolor{ansi-blue}{=} change\textcolor{ansi-blue}{.}new
\textcolor{ansi-green}{--> 624}\textcolor{ansi-red}{         self.\_get\_run\_logs\_async(self.widget\_instance.run\_properties['log\_files'],
}\textcolor{ansi-green-intense}{\textbf{    625}}                                  self\textcolor{ansi-blue}{.}widget\_instance\textcolor{ansi-blue}{.}run\_properties\textcolor{ansi-blue}{[}\textcolor{ansi-blue}{'status'}\textcolor{ansi-blue}{]}\textcolor{ansi-blue}{,}
\textcolor{ansi-green-intense}{\textbf{    626}}                                  self.error, change.new)

\textcolor{ansi-red}{KeyError}: 'log\_files'
    \end{Verbatim}

    Once again, we can get the metrics and outputs from the completed run.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Get logged metrics}
\PY{n}{metrics} \PY{o}{=} \PY{n}{run}\PY{o}{.}\PY{n}{get\PYZus{}metrics}\PY{p}{(}\PY{p}{)}
\PY{k}{for} \PY{n}{key} \PY{o+ow}{in} \PY{n}{metrics}\PY{o}{.}\PY{n}{keys}\PY{p}{(}\PY{p}{)}\PY{p}{:}
        \PY{n+nb}{print}\PY{p}{(}\PY{n}{key}\PY{p}{,} \PY{n}{metrics}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{n}{key}\PY{p}{)}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{k}{for} \PY{n}{file} \PY{o+ow}{in} \PY{n}{run}\PY{o}{.}\PY{n}{get\PYZus{}file\PYZus{}names}\PY{p}{(}\PY{p}{)}\PY{p}{:}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{file}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \hypertarget{register-a-new-version-of-the-model}{%
\subsection{Register a new version of the
model}\label{register-a-new-version-of-the-model}}

Now that you've trained a new model, you can register it as a new
version in the workspace.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{10}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{from} \PY{n+nn}{azureml}\PY{n+nn}{.}\PY{n+nn}{core} \PY{k+kn}{import} \PY{n}{Model}

\PY{c+c1}{\PYZsh{} Register the model}
\PY{n}{run}\PY{o}{.}\PY{n}{register\PYZus{}model}\PY{p}{(}\PY{n}{model\PYZus{}path}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{outputs/diabetes\PYZus{}model.pkl}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{model\PYZus{}name}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{diabetes\PYZus{}model}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                   \PY{n}{tags}\PY{o}{=}\PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Training context}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Parameterized script}\PY{l+s+s1}{\PYZsq{}}\PY{p}{\PYZcb{}}\PY{p}{,}
                   \PY{n}{properties}\PY{o}{=}\PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AUC}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{run}\PY{o}{.}\PY{n}{get\PYZus{}metrics}\PY{p}{(}\PY{p}{)}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AUC}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Accuracy}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{run}\PY{o}{.}\PY{n}{get\PYZus{}metrics}\PY{p}{(}\PY{p}{)}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Accuracy}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{\PYZcb{}}\PY{p}{)}

\PY{c+c1}{\PYZsh{} List registered models}
\PY{k}{for} \PY{n}{model} \PY{o+ow}{in} \PY{n}{Model}\PY{o}{.}\PY{n}{list}\PY{p}{(}\PY{n}{ws}\PY{p}{)}\PY{p}{:}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{model}\PY{o}{.}\PY{n}{name}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{version:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{model}\PY{o}{.}\PY{n}{version}\PY{p}{)}
    \PY{k}{for} \PY{n}{tag\PYZus{}name} \PY{o+ow}{in} \PY{n}{model}\PY{o}{.}\PY{n}{tags}\PY{p}{:}
        \PY{n}{tag} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{tags}\PY{p}{[}\PY{n}{tag\PYZus{}name}\PY{p}{]}
        \PY{n+nb}{print} \PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}t}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{tag\PYZus{}name}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{tag}\PY{p}{)}
    \PY{k}{for} \PY{n}{prop\PYZus{}name} \PY{o+ow}{in} \PY{n}{model}\PY{o}{.}\PY{n}{properties}\PY{p}{:}
        \PY{n}{prop} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{properties}\PY{p}{[}\PY{n}{prop\PYZus{}name}\PY{p}{]}
        \PY{n+nb}{print} \PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}t}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{prop\PYZus{}name}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{prop}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
diabetes\_model version: 2
         Training context : Parameterized script
         AUC : 0.8484377332205582
         Accuracy : 0.774


diabetes\_model version: 1
         Training context : Script
         AUC : 0.8483377282451863
         Accuracy : 0.774


amlstudio-designer-predict-dia version: 1
         CreatedByAMLStudio : true


AutoMLfc1f1f9bf0 version: 1


    \end{Verbatim}

    You can also view registered models in your workspace on the
\textbf{Models} page in \href{https://ml.azure.com}{Azure Machine
Learning studio}.

If you've finished exploring, you can close this notebook and shut down
your compute instance.


    % Add a bibliography block to the postdoc
    
    
    
\end{document}
